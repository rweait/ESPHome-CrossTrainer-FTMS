esphome:
  name: ESPHome_CrossTrainer_FTMS
  friendly_name: "ESPHome Cross Trainer FTMS"

external_components:
- source: 
  type: git
  url: https://github.com/rweait/ESPHome-CrossTrainer-FTMS

esp32:
  board: seeed_xiao_esp32s3
  framework:
    type: esp-idf

# Enable logging
logger:
  level: INFO
#  baud_rate: 9600

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption

ota:
  - platform: esphome
    password: !secret OTA_password

# safe_mode:
#   num_attempts: 1

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

#removed uart stuff

time:
  - platform: homeassistant
    id: homeassistant_time
    timezone: Europe/Brussels

# remove a bunch of stuff

  - id: ftms_status_to_string
    type: std::function<std::string(uint8_t)>
    restore_value: no
    initial_value: |-
      [](uint8_t code) -> std::string {
        switch (code) {
          case 0x01: return "Reset";
          case 0x02: return "Stopped or Paused";
          case 0x03: return "Stopped by Safety Key";
          case 0x04: return "Started or Resumed";
          case 0x05: return "Target Speed Changed";
          case 0x06: return "Target Incline Changed";
          case 0x07: return "Target Resistance Level Changed";
          case 0x08: return "Target Power Changed";
          case 0x09: return "Target Heart Rate Changed";
          case 0x0A: return "Targeted Expended Energy Changed";
          case 0x0B: return "Targeted Number of Steps Changed";
          case 0x0C: return "Targeted Number of Strides Changed";
          case 0x0D: return "Targeted Distance Changed";
          case 0x0E: return "Targeted Training Time Changed";
          case 0xFF: return "Control Permission Lost";
          default: return "Unknown (" + std::to_string(code) + ")";
        }
      }
  - id: training_status_to_string
    type: std::function<std::string(uint8_t)>
    restore_value: no
    initial_value: |-
      [](uint8_t code) -> std::string {
        switch (code) {
          case 0x00: return "Other";
          case 0x01: return "Idle";
          case 0x02: return "Warming Up";
          case 0x03: return "Low Intensity Interval";
          case 0x04: return "High Intensity Interval";
          case 0x05: return "Recovery Interval";
          case 0x06: return "Isometric";
          case 0x07: return "Heart Rate Control";
          case 0x08: return "Fitness Test";
          case 0x09: return "Speed Outside of Control Region - Low";
          case 0x0A: return "Speed Outside of Control Region - High";
          case 0x0B: return "Cool Down";
          case 0x0C: return "Watt Control";
          case 0x0D: return "Manual Mode";
          case 0x0E: return "Pre-Workout";
          case 0x0F: return "Post-Workout";
          default: return "Unknown (" + std::to_string(code) + ")";
        }
      }

  - id: last_ftms_status
    type: std::vector<uint8_t>
    restore_value: no
    initial_value: '{0x02, 0x01}'  # Stopped or Paused by User
  - id: last_training_status
    type: std::vector<uint8_t>
    restore_value: no
    initial_value: '{0x00, 0x01}'  # Idle, без строки


#---------------------------------- средние значения для хранения
# для учета времени по зонам
  - id: zone1_time
    type: int
    initial_value: '0'
  - id: zone2_time
    type: int
    initial_value: '0'
  - id: zone3_time
    type: int
    initial_value: '0'
  - id: zone4_time
    type: int
    initial_value: '0'
  - id: zone5_time
    type: int
    initial_value: '0'

  - id: total_time_min
    type: float
    initial_value: '0.0'  # Накопленное время
  - id: total_distance_km
    type: float
    initial_value: '0.0'  # Накопленная дистанция
  - id: total_speed_sum
    type: float
    initial_value: '0.0'  # Сумма скоростей для среднего
  - id: speed_count
    type: int
    initial_value: '0'    # Количество измерений скорости
  - id: total_incline_sum
    type: float
    initial_value: '0.0'  # Сумма наклона для среднего
  - id: incline_count
    type: int
    initial_value: '0'    # Количество измерений наклона
  - id: total_heart_rate_sum
    type: float
    initial_value: '0.0'  # Сумма пульса для среднего
  - id: heart_rate_count
    type: int
    initial_value: '0'    # Количество измерений пульса
  - id: max_heart_rate_total
    type: float
    initial_value: '0.0'  # Максимальный пульс

  - id: current_zone
    type: int
    initial_value: '0'

#переменные для хранения данных после тренировки:
  - id: last_time_stored
    type: float
    initial_value: '0.0'
  - id: last_distance_stored
    type: float
    initial_value: '0.0'
  - id: last_calories_stored
    type: int
    initial_value: '0'
  - id: avg_speed_stored
    type: float
    initial_value: '0.0'
  - id: avg_incline_stored
    type: float
    initial_value: '0.0'
  - id: avg_heart_rate_stored
    type: float
    initial_value: '0.0'
  - id: max_heart_rate_stored
    type: float
    initial_value: '0.0'
  - id: zone1_time_stored
    type: int
    initial_value: '0'
  - id: zone2_time_stored
    type: int
    initial_value: '0'
  - id: zone3_time_stored
    type: int
    initial_value: '0'
  - id: zone4_time_stored
    type: int
    initial_value: '0'
  - id: zone5_time_stored
    type: int
    initial_value: '0'

  - id: total_met_sum
    type: float
    initial_value: '0.0'
  - id: met_count
    type: int
    initial_value: '0'

  - id: log_lines_global
    type: std::vector<std::string>

  - id: fat_grams_stored
    type: float
    initial_value: '0.0'  # Хранит количество сожжённого жира в граммах

